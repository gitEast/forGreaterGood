<!--
 * @Author: East
 * @Date: 2022-01-03 10:03:03
 * @LastEditTime: 2022-01-03 13:44:33
 * @LastEditors: Please set LastEditors
 * @Description: 纯函数 + 柯里化实现 + 组合函数
 * @FilePath: \forGreaterGood\javascript\07-纯函数+柯里化+组合函数.md
-->

# JS 函数式编程

> 已知函数是 js 中的第一公民

## 一、纯函数

> 在 react 中，纯函数是非常重要的

### 概念

- 函数式编程中有一个非常重要的概念叫做**纯函数**，js 符合函数式编程的范式(标准)，所有也有纯函数的概念
  - 在 react 开发中，纯函数是被多次提及的
    - 比如在 react 组件中就被要求是一个纯函数(react 18 就要求组件为函数式组件了)，redux 中有一个 reducer 的概念，也要求必须是一个纯函数
  - 所以掌握纯函数对于理解很多框架的设计是非常有帮助的
- 维基定义
  - 在程序设计中，若一个函数符合以下条件，那么这个函数被称为纯函数：
    1. 此函数在相同的输入值时，需产生相同的输出值
    2. 与函数的输入和输出值以外的其他隐藏信息或状态无关，也和由 I/O 设备产生的外部输出无关
    3. 该函数不能有语义上可观察的函数副作用，诸如“触发事件”，使输出设备输出，或更改输出值以外物件的内容等。
- 简单总结
  1. **确定的输入**，一定会产生**确定的输出**
  2. 函数在执行过程中，不能产生**副作用**
- 副作用(side effect)
  - 在执行一个函数时，除了返回函数值之外，还对调用函数产生了*附加的影响*，比如修改了全局变量、修改参数或改变外部的存储
  - 纯函数在执行的过程中不能产生这样的副作用
    - 副作用往往是产生 bug 的“温床”

### 案例

```js
var names = ["abc", "cba", "nba", "dna"];
```

- 纯函数
  ```js
  var newArr = names.slice(0, 3); // ["abc", "cba", "nba"]
  console.log(names); // ["abc", "cba", "nba", "dna"]
  ```
- 非纯函数
  ```js
  var newArr = names.splice(2); // ['nba', 'dna']
  console.log(names); // ['abc', 'cba']
  ```

### 纯函数的优势

1. 安心地编写和安心地使用
   - 写的时候：保证了函数的纯度，只是单纯实现自己的业务逻辑即可，无需关心传入的内容是如何获得的或者依赖其他的外部变量是否已经发生了修改
   - 用的时候：确定输入的内容不会被任意篡改，并且确定的输入，一定会有确定的输出
2. react 中就要求无论是函数还是 class 声明一个组件，这个组件都必须像纯函数一样，保护它们的 props 不被修改

## 二、柯里化

### 柯里化的概念

> 柯里化也是属于函数式编程里面的一个非常重要的概念

- 维基解释
  1. 在计算机科学中，柯里化(currying)，又译为卡瑞化或加里化
  2. 是把接收多个参数的函数，变成接收一个单一参数(最初函数的第一个参数)的函数，并且返回接收余下的参数+返回结果的新函数的技术
  3. 柯里化声称：如果你固定某些参数，你将得到接收余下参数的一个函数
- 总结
  1. 只传递给函数一部分参数来调用它，让它返回一个函数去处理剩余的参数
  2. 这个过程就称之为柯里化
  3. 例：bind 函数

### 柯里化的优势

1. 让函数的职责单一
   1. 在函数式编程中，我们往往希望一个函数处理的问题尽可能单一，而不是将一大堆的处理过程交给一个函数来处理 --> 单一职责原则
   2. 那么，可以将每次传入的参数在单一的函数中进行处理，处理完后在下一个函数中再使用处理后的结果
2. 逻辑的复用

### 一个实现柯里化的函数

1. eastCurrying(fn) + 返回一个新的函数 curried
2. curried 可能接收 n 个参数 --> curried(...args)
3. 判断 curried 函数接收的参数个数与原函数需要接收的参数个数：`args.length` 与 `fn.length`
   - 如果一致 --> fn(...args)
     - 如果绑定了 this --> fn.call(this, ...args)
   - 如果不一致 --> `function (...args2) { return curried.call(this, ...args, ...args2) }`
4. 具体实现见 [07-code/currying.js](./07-code/currying.js)

## 三、组合函数

- 组合(compose)函数是在 JavaScript 开发过程中一种对函数的使用技巧、模式
  1. 比如我们现在需要对某一数据进行函数调用，执行两个函数 fn1, fn2，这两个函数是依次执行的
  2. 如果每次都进行两个函数的调用，操作上会显得重复
  3. 那么是否可以将这两个函数组合起来，自动依次调用呢？
  4. 这个过程就是对函数的组合，称之为组合函数(Compose Function)
- 自制组合函数
  1. myCompose(...fns)
  2. 判断是否传入的都是函数：`throw new TypeError('Excepted arguments are functions')
  3. 返回一个组合后的函数 compose(...args)
  4. compose 函数返回最终结果
  5. 具体实现见 [07-code/compose.js](./07-code/compose.js)
