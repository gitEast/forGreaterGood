<!--
 * @Author: East
 * @Date: 2021-11-10 16:21:14
 * @LastEditTime: 2021-11-10 18:04:18
 * @LastEditors: Please set LastEditors
 * @Description: 跨组件通信 和 插槽的使用
 * @FilePath: \forGreaterGood\vue3\12-跨组件通信与插槽.md
-->
# 跨组件通信和插槽
## 跨组件通信
### 非父子组件的通信
> 在开发中，构建组件树之后，除了非父子组件之间的通信之外，还会有非父子组件之间的通信
#### Provide/Inject
+ 无论层级结构有多深，母组件都可以作为其所有女组件的依赖提供者
  + 母组件有一个 provide 选项来提供数据
  + 女组件有一个 inject 选项来使用这些数据
+ 可以将依赖注入看作是 **long range props**
+ 案例
  ```js
  /** 母组件 */
  provide: {
    name: 'East', // 在自个儿中不能使用
  }

  /** 女组件 */
  inject: ['name']
  ```
+ provide 中的 this 是这个 `<script>` 作用域中的 `this`，即 `undefined`
  - 如果一定要用 this
    ```js
    import { computed } from 'vue'
    provide() {
      return {
        length: this.arr.length, // 此时 this.arr 改变时，length 不会改变
        length1: computed(() => this.arr.length) // 返回 ref 对象，使用需要用 .value
      }
    }
    ```
#### Mitt 全局事件总线
> Vue3 从实例中移除了 $on、$off 和 $once 方法，所以如果希望继续使用全局事件总线，要通过第三方的库
+ Vue3 官方推荐：mitt 和 tiny-emitter

1. `npm install mitt`
2. 封装 eventBus.js 工具
   ```js
   import mitt from 'mitt' // 返回了一个函数

   const emitter = mitt()
   export default emitter
   ```
3. About.vue 中事件传给 HomeContent.vue
   ```html
   <!-- About.vue -->
   <template>
     <div>
       <button @click="btnClick">按钮点击</button>
     </div>
   </template>

   <script>
     import emitter from '../util/eventBus'
     export default {
       methods: {
         btnClick() {
           console.log('About 中按钮的点击')
           emitter.emit('why', { name: 'east' })
         }
       }
     }
   </script>

   <!-- HomeContent.vue -->
   <template>
     <div>
     </div>
   </template>

   <script>
     import emiter from '../util/eventBus'
     export default {
       created() {
         emiter.on('why', (info) => {
           console.log(info)
         })

         emiter.on('*', (type, info) => { // 监听所有事件
           console.log(type, info)
         })

       }
     }
   </script>
   ```
4. 取消事件监听
   ```js
   // 1. 取消所有监听
   emitter.all.clear()

   // 2. 单个取消
   function onFoo() {}
   emitter.on('foo', onFoo)
   emitter.off('foo', onFoo)
   ```

## 插槽 Slot
### 认识插槽
+ 在开发中，会经常封装一个个可复用的组件
  - 在前面，我们会通过 props 传递给组件一些数据，让组件来进行展示
  - 但是为了让这个组件具备更强的通用性，我们不能将组件中的内容限制为固定的 div、span 等元素
    * 比如某种情况下，希望组件显示的是一个按钮，不同情况下又希望显示的是一张图片
  - 我们应该让使用者可以决定某一块区域到底存放什么内容

### 如何使用插槽 slot？
+ 定义 slot
  - 插槽的使用过程其实是**抽取共性、预留不同**
  - 将**共同的元素、内容**依然在组件内进行封装
  - 同时将**不同的元素使用 slot 作为占位**，让外部决定到底显示什么样的元素
+ 如何使用
  - Vue 中将 `<slot>` 元素作为**承载分发内容的出口**
  - 在封装组件中，使用**特殊的元素`<slot>`**就可以为封装的组件开启一个插槽
  - 该插槽插入什么内容取决于母组件如何使用
